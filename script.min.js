function clickEffect(e){const t=document.createElement("div");t.className="clickEffect",t.style.top=e.clientY+"px",t.style.left=e.clientX+"px",document.body.appendChild(t),t.addEventListener("animationend",(function(){t.parentElement.removeChild(t)}))}"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js"),document.addEventListener("click",clickEffect);const bid=document.getElementById("search_baidu");function baidu(e){const t=e.s.length,n=document.getElementById("keywordb"),o=document.getElementById("googlebar");0===t?(n.style.display="none",o.style.display="block"):(n.style.transform="scaleY(1)",n.style.display="block",o.style.display="none");let a="";for(let n=0;n<t;n++)a+="<span>"+e.s[n]+"</span>";n.innerHTML=a;for(let e=0;e<n.children.length;e++){n.children[e].onclick=function(){bid.value=this.innerHTML,bid.focus(),tobaidu()}}document.body.addEventListener("click",(function(e){const t=e.target;"keywordb"!==t.id&&"baidubar"!==t.id&&"search_baidu"!==t.id&&(n.style.transform="scaleY(0)",o.style.display="block",n.style.display="none")}),!1)}bid.addEventListener("input",(function(){if(!bid.value)return;const e=document.createElement("script");e.type="text/javascript",e.src="https://suggestion.baidu.com/su?wd="+bid.value+"&cb=baidu";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}),!1);const gid=document.getElementById("search_google");function google(e){const t=e[1].length,n=document.getElementById("keywordg"),o=document.getElementById("baidubar");0===t?(n.style.display="none",o.style.display="block"):(n.style.transform="scaleY(1)",n.style.display="block",o.style.display="none");let a="";for(let n=0;n<t;n++)a+="<span>"+e[1][n]+"</span>";n.innerHTML=a;for(let e=0;e<n.children.length;e++){n.children[e].onclick=function(){gid.value=this.innerHTML,gid.focus(),togoogle()}}document.body.addEventListener("click",(function(e){const t=e.target;"keywordb"!==t.id&&"googlebar"!==t.id&&"search_google"!==t.id&&(n.style.transform="scaleY(0)",o.style.display="block",n.style.display="none")}),!1)}function tobaidu(){return""!==bid.value&&(window.location.href="https://www.baidu.com/s?wd="+bid.value,bid.value=""),!1}function togoogle(){return""!==gid.value&&(window.location.href="https://www.google.com/search?q="+gid.value,gid.value=""),!1}gid.addEventListener("input",(function(){if(!gid.value)return;const e=document.createElement("script");e.type="text/javascript",e.src="https://suggestqueries.google.com/complete/search?q="+gid.value+"&output=firefox&callback=google";const t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}),!1),gsap.registerPlugin(MotionPathPlugin);const container=document.getElementById("weathercontainer"),card=document.getElementById("card");window.innerWidth<=717&&card.classList.remove("nmbar");const innerSVG=Snap("#inner"),outerSVG=Snap("#outer"),backSVG=Snap("#back"),weatherContainer1=Snap.select("#layer1"),weatherContainer2=Snap.select("#layer2"),weatherContainer3=Snap.select("#layer3"),innerRainHolder1=weatherContainer1.group(),innerRainHolder2=weatherContainer2.group(),innerRainHolder3=weatherContainer3.group(),innerLeafHolder=weatherContainer1.group(),innerSnowHolder=weatherContainer1.group(),innerLightningHolder=weatherContainer1.group(),leafMask=outerSVG.rect(),leaf=Snap.select("#leaf"),sun=Snap.select("#sun"),sunburst=Snap.select("#sunburst"),outerSplashHolder=outerSVG.group(),outerLeafHolder=outerSVG.group(),outerSnowHolder=outerSVG.group();let currentWeather,lightningTimeout;outerLeafHolder.attr({"clip-path":leafMask});const sizes={container:{width:0,height:0},card:{width:0,height:0}},clouds=[{group:Snap.select("#cloud1")},{group:Snap.select("#cloud2")},{group:Snap.select("#cloud3")}],weather=[{type:"snow"},{type:"wind"},{type:"rain"},{type:"thunder"},{type:"sun"},{type:"cloud"},{type:"haze"},{type:"drizzle"},{type:"clearwind"}],settings={windSpeed:2,rainCount:0,leafCount:0,snowCount:0,cloudHeight:100,cloudSpace:30,cloudArch:50,renewCheck:10,splashBounce:80};let tickCount=0;const rain=[],leafs=[],snow=[];function init(e){onResize();for(let e=0;e<clouds.length;e++)clouds[e].offset=Math.random()*sizes.card.width,drawCloud(clouds[e],e);gsap.set(sunburst.node,{opacity:0}),changeWeather(weather[e])}function onResize(){sizes.container.width=container.offsetWidth,sizes.container.height=container.offsetHeight,sizes.card.width=card.offsetWidth,sizes.card.height=card.offsetHeight,innerSVG.attr({width:sizes.card.width,height:sizes.card.height}),outerSVG.attr({width:sizes.container.width,height:sizes.container.height}),backSVG.attr({width:sizes.container.width,height:sizes.container.height}),gsap.set(sunburst.node,{transformOrigin:"50% 50%",x:sizes.container.width/2,y:sizes.container.height/2}),gsap.fromTo(sunburst.node,20,{rotation:0},{rotation:360,repeat:-1,ease:"power0.inOut"}),leafMask.attr({x:0,y:0,width:sizes.container.width,height:sizes.container.height})}function drawCloud(e,t){const n=settings.cloudSpace*t+settings.cloudHeight,o=n+settings.cloudArch+Math.random()*settings.cloudArch,a=sizes.card.width,i=[];i.push("M"+[-a,0].join(",")),i.push([a,0].join(",")),i.push("Q"+[2*a,n/2].join(",")),i.push([a,n].join(",")),i.push("Q"+[.5*a,o].join(",")),i.push([0,n].join(",")),i.push("Q"+[-.5*a,o].join(",")),i.push([-a,n].join(",")),i.push("Q"+[-2*a,n/2].join(",")),i.push([-a,0].join(","));const s=i.join(" ");e.path||(e.path=e.group.path()),e.path.animate({d:s},0)}function makeRain(){const e=3*Math.random(),t="thunder"===currentWeather.type?35:14,n=Math.random()*(sizes.card.width-40)+20,o=this["innerRainHolder"+(3-Math.floor(e))].path("M0,0 0,"+t).attr({fill:"none",stroke:"thunder"===currentWeather.type?"#777":"#0000ff",strokeWidth:e});rain.push(o),gsap.fromTo(o.node,{x:n,y:0-t},{duration:1,delay:Math.random(),y:sizes.card.height,ease:"power2.in",onComplete:onRainEnd,onCompleteParams:[o,e,n,currentWeather.type]})}function onRainEnd(e,t,n,o){e.remove(),e=null;for(const e in rain)rain[e].paper||rain.splice(e,1);rain.length<settings.rainCount&&(makeRain(),t>2&&makeSplash(n,o))}function makeSplash(e,t){const n="thunder"===t?30:20,o="thunder"===t?120:100,a="thunder"===t?.7:.5,i=0-Math.random()*o,s=80*Math.random()-40,r=[];r.push("M0,0"),r.push("Q"+s+","+i),r.push(2*s+",80");const d=outerSplashHolder.path(r.join(" ")).attr({fill:"none",stroke:"thunder"===t?"#777":"#0000ff",strokeWidth:1}),c=Snap.path.getTotalLength(d),l=(sizes.container.width-sizes.card.width)/2,u=(sizes.container.height-sizes.card.height)/2+sizes.card.height;d.node.style.strokeDasharray=n+" "+c,gsap.fromTo(d.node,{strokeWidth:2,y:u,x:l+20+e,opacity:1,strokeDashoffset:n},{duration:a,strokeWidth:0,strokeDashoffset:-c,opacity:1,onComplete:onSplashComplete,onCompleteParams:[d],ease:"slow(0.4, 0.1, false)"})}function onSplashComplete(e){e.remove(),e=null}function makeLeaf(){const e=.5+.5*Math.random();let t,n;const o=sizes.card.height/2;let a,i=o+Math.random()*o,s=i-(Math.random()*(2*o)-o);const r=["#76993E","#4A5E23","#6D632F"],d=r[Math.floor(Math.random()*r.length)];let c;if(e>.8){n=leaf.clone().appendTo(outerLeafHolder).attr({fill:d}),a=(sizes.container.width-sizes.card.width)/2,i+=10,s+=10,c=(sizes.container.width+a)/2,leafs.push(n);const t=[{x:a,y:i},{x:c,y:Math.random()*s+s/3},{x:sizes.container.width+50,y:s}];gsap.fromTo(n.node,{rotation:180*Math.random(),x:a,y:o+Math.random()*o+10,scale:e},{duration:2,rotation:360*Math.random(),motionPath:t,onComplete:onLeafEnd,onCompleteParams:[n],ease:"power0.in"})}else{t=leaf.clone().appendTo(innerLeafHolder).attr({fill:d}),a=-100,c=sizes.card.width/2,leafs.push(t);const n=[{x:a,y:i},{x:c,y:Math.random()*s+s/3},{x:sizes.card.width+50,y:s}];gsap.fromTo(t.node,{rotation:180*Math.random(),x:a,y:o+Math.random()*o,scale:e},{duration:2,rotation:360*Math.random(),motionPath:n,onComplete:onLeafEnd,onCompleteParams:[t],ease:"power0.in"})}}function onLeafEnd(e){e.remove(),e=null;for(const e in leafs)leafs[e].paper||leafs.splice(e,1);leafs.length<settings.leafCount&&makeLeaf()}function makeSnow(){const e=.5+.5*Math.random();let t,n,o=20+Math.random()*(sizes.card.width-40),a=-10;e>.8?(t=outerSnowHolder.circle(0,0,5).attr({fill:"white"}),n=sizes.container.height+10,a=(sizes.container.height-sizes.card.height)/2+settings.cloudHeight,o+=(sizes.container.width-sizes.card.width)/2):(t=innerSnowHolder.circle(0,0,5).attr({fill:"white"}),n=sizes.card.height+10),snow.push(t),gsap.fromTo(t.node,{x:o,y:a},{duration:3+5*Math.random(),y:n,onComplete:onSnowEnd,onCompleteParams:[t],ease:"power0.in"}),gsap.fromTo(t.node,{scale:0},{duration:1,scale:e,ease:"power1.inOut"}),gsap.to(t.node,{duration:2,x:o+(150*Math.random()-75),repeat:-1,yoyo:!0,ease:"power1.inOut"})}function onSnowEnd(e){e.remove(),e=null;for(const e in snow)snow[e].paper||snow.splice(e,1);snow.length<settings.snowCount&&makeSnow()}function tick(){tickCount++;tickCount%settings.renewCheck&&(rain.length<settings.rainCount&&makeRain(),leafs.length<settings.leafCount&&makeLeaf(),snow.length<settings.snowCount&&makeSnow());for(let e=0;e<clouds.length;e++)"sun"===currentWeather.type||"clearwind"===currentWeather.type?(clouds[e].offset>-1.5*sizes.card.width&&(clouds[e].offset+=settings.windSpeed/(e+1)),clouds[e].offset>2.5*sizes.card.width&&(clouds[e].offset=-1.5*sizes.card.width),clouds[e].group.transform("t"+clouds[e].offset+",0")):(clouds[e].offset+=settings.windSpeed/(e+1),clouds[e].offset>sizes.card.width&&(clouds[e].offset=clouds[e].offset-sizes.card.width+0),clouds[e].group.transform("t"+clouds[e].offset+",0"));requestAnimationFrame(tick)}function reset(){for(let e=0;e<weather.length;e++)container.classList.remove(weather[e].type)}function startLightningTimer(){lightningTimeout&&clearTimeout(lightningTimeout),"thunder"===currentWeather.type&&(lightningTimeout=setTimeout(lightning,6e3*Math.random()))}function lightning(){startLightningTimer(),gsap.fromTo(card,{y:-30},{duration:.75,y:0,ease:"elastic"});const e=30+Math.random()*(sizes.card.width-60),t=[e+",0"];for(let n=0;n<20;n++){const o=e+(20*Math.random()-10),a=sizes.card.height/20*(n+1);t.push(o+","+a)}let n=weatherContainer1.path("M"+t.join(" ")).attr({fill:"none",stroke:"white",strokeWidth:2+Math.random()});gsap.to(n.node,{duration:1,opacity:0,ease:"power4.out",onComplete:function(){n.remove(),n=null}})}function changeWeather(e){switch(e.data&&(e=e.data),reset(),currentWeather=e,container.classList.add(e.type),e.type){case"cloud":gsap.to(settings,{duration:3,windSpeed:1.5,ease:"power2.inOut"});break;case"wind":gsap.to(settings,{duration:3,windSpeed:8,ease:"power2.inOut"});break;case"sun":case"clearwind":gsap.to(settings,{duration:3,windSpeed:20,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:3,windSpeed:.5,ease:"power2.out"})}switch(e.type){case"rain":gsap.to(settings,{duration:3,rainCount:20,ease:"power2.inOut"});break;case"drizzle":gsap.to(settings,{duration:3,rainCount:5,ease:"power2.inOut"});break;case"thunder":gsap.to(settings,{duration:3,rainCount:60,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,rainCount:0,ease:"power2.out"})}switch(e.type){case"wind":case"clearwind":gsap.to(settings,{duration:3,leafCount:5,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,leafCount:0,ease:"power2.out"})}if("snow"===e.type)gsap.to(settings,{duration:3,snowCount:40,ease:"power2.inOut"});else gsap.to(settings,{duration:1,snowCount:0,ease:"power2.out"});switch(e.type){case"sun":case"clearwind":gsap.to(sun.node,{duration:4,x:sizes.card.width/2,y:sizes.card.height/2,ease:"power2.inOut"}),window.innerWidth<=717?gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2-80,ease:"power2.inOut"}):gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2,ease:"power2.inOut"});break;default:gsap.to(sun.node,{duration:2,x:sizes.card.width/2,y:-100,ease:"power2.inOut"}),gsap.to(sunburst.node,{duration:2,scale:.4,opacity:0,y:sizes.container.height/2-50,ease:"power2.inOut"})}startLightningTimer()}getWeather();const xhr=new XMLHttpRequest;function getWeather(){const e=new XMLHttpRequest;e.open("get","https://api.weatherapi.com/v1/forecast.json?key=483957d90eb54b5d88552513210506&q=auto:ip&days=1"),e.onreadystatechange=function(){if(4===e.readyState){const t=JSON.parse(e.responseText);handleJson(t.location.name,t.current.temp_c,t.current.condition.text,t.current.condition.code,t.current.wind_kph,t.current.humidity,t.forecast.forecastday[0])}},e.send()}function handleJson(e,t,n,o,a,i,s){document.getElementById("city").innerHTML=e+" &#xe901",document.getElementById("detail").innerHTML=n,document.getElementById("temp").innerHTML=t+"<span>℃</span>";const r=s.astro.sunrise.split(":"),d=parseFloat(r[1].split(" ")[0]),c=s.astro.sunset.split(":");let l=parseFloat(c[0]);3===c[1].indexOf("PM")&&(l+=12);const u=parseFloat(c[1].split(" ")[0]);let h,p;document.getElementById("temprange").innerHTML="<p>"+s.day.mintemp_c+"℃ to "+s.day.maxtemp_c+"℃</p><p> &#xe90b "+i+"%</p><p>&#xe9d6 "+r[0]+":"+d+" to "+l+":"+u+"</p>",1066===o||1069===o||1114===o||1204===o||1207===o||1210===o||1213===o||1216===o||1219===o||1222===o||1225===o||1237===o||1249===o||1252===o||1255===o||1258===o||1261===o||1264===o||1279===o||1282===o?(h=0,p="Snow"):o>1272&&o<1283?(h=3,p="Drizzle"):1e3===o&&a<29?(h=4,p="Clear"):1e3===o?(h=8,p="Wind"):o>1002&&o<1010&&a<29?(h=5,p="Cloud"):o>1002&&o<1010?(h=1,p="Wind"):1030===o||1135===o||1147===o?(h=6,p="Fog"):1072===o||o>1149&&o<1172?h=7:(h=2,p="Rain"),document.getElementById("summary").innerHTML=p,document.getElementById("time").innerHTML=(new Date).getHours()+":"+checkTime((new Date).getMinutes());setBackground(60*parseFloat(r[0])+d,60*l+u),init(h),window.addEventListener("resize",widgetResize),requestAnimationFrame(tick)}function printH(e,t,n){document.getElementById("hitokoto").innerHTML=null==t?e+"<p>──《"+n+"》</p>":e+"<p>──"+t+"《"+n+"》</p>"}function widgetResize(){onResize();for(let e=0;e<clouds.length;e++)clouds[e].offset=Math.random()*sizes.card.width,drawCloud(clouds[e],e);changeWeather(currentWeather)}function checkTime(e){return e<10&&(e="0"+e),e}function loadStyleString(e){const t=document.createElement("style");try{t.appendChild(document.createTextNode(e))}catch(n){t.styleSheet.cssText=e}document.getElementsByTagName("head")[0].appendChild(t)}function setBackground(e,t){const n=(t-e)/8,o=60*(new Date).getHours()+(new Date).getMinutes();let a,i;o<=e-1.5*n?(a="n5",i="#755be3"):o>e-1.5*n&&o<=e-n/2?(a="n6",i="#2a6a9e"):o>e-n/2&&o<=e?(a="d0",i="#ed95d1"):o>e&&o<=e+n/2?(a="d1",i="#de9cd7"):o>e+n/2&&o<=e+1.5*n?(a="d2",i="#3c82cc"):o>e+1.5*n&&o<=e+3*n?(a="d3",i="#95bdcc"):o>e+3*n&&o<=e+4*n?(a="d4",i="#68c9f1"):o>e+4*n&&o<=e+5*n?(a="d5",i="#2fa0e6"):o>e+5*n&&o<=e+6*n?(a="d6",i="#6b8b4c"):o>e+6*n&&o<=e+7.5*n?(a="d7",i="#af5c18"):o>e+7.5*n&&o<=t?(a="d8",i="#da644f"):o>t&&o<=t+n/2?(a="n0",i="#b6bbf5"):o>t+n/2&&o<=t+1.5*n?(a="n1",i="#897ddc"):o>t+1.5*n&&o<=t+3*n?(a="n2",i="#3e7ee3"):o>t+3*n&&o<=1320?(a="n3",i="#36315a"):o>1320&&(a="n4",i="#3d3d88");let s="0";const r=new URLSearchParams(window.location.search);s=r.get("hres"),j=1==s?"-4x-AnimeSharp.webp":".webp",anime=r.get("anime"),1==anime&&(j=".jpg",document.querySelectorAll('link[rel="icon"]')[0].href="icon/favicon-32x32.png",document.querySelectorAll('link[rel="icon"]')[1].href="icon/favicon-16x16.png"),document.querySelector("meta[name=theme-color]").setAttribute("content",i),loadStyleString("#fill_screen{background:url('/background/"+a+j+"') no-repeat local center center/cover;}")}xhr.open("get","https://v1.hitokoto.cn/?c=i"),xhr.onreadystatechange=function(){if(4===xhr.readyState){const e=JSON.parse(xhr.responseText);printH(e.hitokoto,e.from_who,e.from)}},xhr.send();const duration=.4;let isDay=!0;const scale=30,toNightAnimation=gsap.timeline();window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.getElementById("sunburst").style.display="none":toNightAnimation.pause(),toNightAnimation.to("#circle",{duration:.4,ease:"power4.in",scaleX:30,scaleY:30,x:1,transformOrigin:"100% 50%"},0).set("#circle",{scaleX:-30},.4).to("#circle",{duration:.4,ease:"power4.out",scaleX:-1,scaleY:1,x:2},.4).fromTo(".filter",{filter:"brightness(100%)"},{filter:"brightness(50%)",duration:.4},0).to(".nmtext,.nmbar",{color:"white",duration:.8},0).to(".nmbar",{background:"rgba(0,0,0,.3)",duration:.4},0).fromTo(".nmbar",{boxShadow:"0 0 18px rgba(70, 70, 40, .255)"},{boxShadow:"0 0 18px rgba(0, 0, 0, .255)",duration:.4},0).to("#cloud1",{fill:"#101010",duration:.4},0).to("#cloud2",{fill:"#191919",duration:.4},0).to("#cloud3",{fill:"#2a2a2a",duration:.4},0).to("#sun",{fill:"#3e3f57",duration:.8},0).to("#sunburst",{opacity:"0",duration:.8},0);const stars=Array.from(document.getElementsByClassName("star"));stars.map((e=>gsap.to(e,{duration:"random(0.4, 1.5)",repeat:-1,yoyo:!0,opacity:"random(0.2, 0.5)"}))),gsap.to(".clouds-big",{duration:15,repeat:-1,x:-74,ease:"linear"}),gsap.to(".clouds-medium",{duration:20,repeat:-1,x:-65,ease:"linear"}),gsap.to(".clouds-small",{duration:25,repeat:-1,x:-71,ease:"linear"});const switchToggle=document.getElementById("input");switchToggle.addEventListener("change",(()=>toggle()));const toggle=()=>{isDay=!0===switchToggle.checked,isDay?(document.getElementById("sunburst").style.display="block",toNightAnimation.reverse()):toNightAnimation.play()};