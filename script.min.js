let duration=.4,isDay=!0,scale=30,toNightAnimation=gsap.timeline();window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches||toNightAnimation.pause(),toNightAnimation.to("#circle",{duration:duration,ease:"power4.in",scaleX:scale,scaleY:scale,x:1,transformOrigin:"100% 50%"},0).set("#circle",{scaleX:-scale},duration).to("#circle",{duration:duration,ease:"power4.out",scaleX:-1,scaleY:1,x:2},duration).fromTo(".filter",{filter:"brightness(100%)"},{filter:"brightness(50%)",duration:duration},0).to(".nmtext,.nmbar",{color:"white",duration:2*duration},0).to(".nmbar",{background:"rgba(0,0,0,.3)",duration:2*duration},0).fromTo(".nmbar",{boxShadow:"0 0 18px rgba(70, 70, 40, .255)"},{boxShadow:"0 0 18px rgba(0, 0, 0, .255)",duration:duration},0).to("#cloud1",{fill:"#101010",duration:2*duration},0).to("#cloud2",{fill:"#191919",duration:2*duration},0).to("#cloud3",{fill:"#2a2a2a",duration:2*duration},0).to("#sun",{fill:"#3e3f57",duration:2*duration},0).to("#sunburst",{display:"none",duration:2*duration},0);let stars=Array.from(document.getElementsByClassName("star"));stars.map((e=>gsap.to(e,{duration:"random(0.4, 1.5)",repeat:-1,yoyo:!0,opacity:"random(0.2, 0.5)"}))),gsap.to(".clouds-big",{duration:15,repeat:-1,x:-74,ease:"linear"}),gsap.to(".clouds-medium",{duration:20,repeat:-1,x:-65,ease:"linear"}),gsap.to(".clouds-small",{duration:25,repeat:-1,x:-71,ease:"linear"});let switchToggle=document.getElementById("input");switchToggle.addEventListener("change",(()=>toggle()));let toggle=()=>{isDay=!0===switchToggle.checked,isDay?toNightAnimation.reverse():toNightAnimation.play()};function clickEffect(e){var t=document.createElement("div");t.className="clickEffect",t.style.top=e.clientY+"px",t.style.left=e.clientX+"px",document.body.appendChild(t),t.addEventListener("animationend",function(){t.parentElement.removeChild(t)}.bind(this))}document.addEventListener("click",clickEffect);var bid=document.getElementById("search_baidu");function baidu(e){var t=e.s.length,n=$("#keywordb"),a=$("#search_baidu"),i=$("#googlebar");0===t?(n.css({display:"none"}),i.css({display:"block"})):(n.css({display:"block"}),i.css({display:"none"}));for(var o="",r=0;r<t;r++)o+="<span>"+e.s[r]+"</span>";n.html(o),n.children().click((function(){a.val($(this).html()),n.animate({height:0},10,(function(){n.css({display:"none",height:"auto"}),i.css({display:"block"}),n.empty()})),a.focus(),$("#baidubar").submit()})),$(document).click((function(){$(event.target).closest("#baidubar,#search_baidu,#keywordb,.night-mode").length||n.animate({height:0},100,(function(){n.css({display:"none",height:"auto"}),i.css({display:"block"}),n.empty()}))}))}bid.addEventListener("keyup",(function(){if(bid.value){var e=document.createElement("script");e.type="text/javascript",e.src="https://suggestion.baidu.com/su?wd="+bid.value+"&cb=baidu";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}),!1);var gid=document.getElementById("search_google");function google(e){var t=e[1].length,n=$("#keywordg"),a=$("#search_google"),i=$("#baidubar");0===t?(n.css({display:"none"}),i.css({display:"block"})):(n.css({display:"block"}),i.css({display:"none"}));for(var o="",r=0;r<t;r++)o+="<span>"+e[1][r]+"</span>";n.html(o),n.children().click((function(){a.val($(this).html()),n.animate({height:0},10,(function(){n.css({display:"none",height:"auto"}),i.css({display:"block"}),n.empty()})),a.focus(),$("#googlebar").submit()})),$(document).click((function(){$(event.target).closest("#googlebar,#search_google,#keywordg,.night-mode").length||n.animate({height:0},100,(function(){n.css({display:"none",height:"auto"}),i.css({display:"block"}),n.empty()}))}))}function tobaidu(){return""!==bid.value&&(window.location.href="https://www.baidu.com/s?wd="+bid.value,bid.value=""),!1}function togoogle(){return""!==gid.value&&(window.location.href="https://www.google.com/search?q="+gid.value,gid.value=""),!1}gid.addEventListener("keyup",(function(){if(gid.value){var e=document.createElement("script");e.type="text/javascript",e.src="https://suggestqueries.google.com/complete/search?q="+gid.value+"&output=firefox&callback=google";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}}),!1),gsap.registerPlugin(MotionPathPlugin),window.innerWidth<=717&&document.getElementById("card").classList.remove("nmbar");var lightningTimeout,container=$("#weathercontainer"),card=$("#card"),innerSVG=Snap("#inner"),outerSVG=Snap("#outer"),backSVG=Snap("#back"),weatherContainer1=Snap.select("#layer1"),weatherContainer2=Snap.select("#layer2"),weatherContainer3=Snap.select("#layer3"),innerRainHolder1=weatherContainer1.group(),innerRainHolder2=weatherContainer2.group(),innerRainHolder3=weatherContainer3.group(),innerLeafHolder=weatherContainer1.group(),innerSnowHolder=weatherContainer1.group(),innerLightningHolder=weatherContainer1.group(),leafMask=outerSVG.rect(),leaf=Snap.select("#leaf"),sun=Snap.select("#sun"),sunburst=Snap.select("#sunburst"),outerSplashHolder=outerSVG.group(),outerLeafHolder=outerSVG.group(),outerSnowHolder=outerSVG.group();outerLeafHolder.attr({"clip-path":leafMask});var sizes={container:{width:0,height:0},card:{width:0,height:0}},clouds=[{group:Snap.select("#cloud1")},{group:Snap.select("#cloud2")},{group:Snap.select("#cloud3")}],weather=[{type:"snow"},{type:"wind"},{type:"rain"},{type:"thunder"},{type:"sun"},{type:"cloud"},{type:"haze"},{type:"drizzle"},{type:"clearwind"}],settings={windSpeed:2,rainCount:0,leafCount:0,snowCount:0,cloudHeight:100,cloudSpace:30,cloudArch:50,renewCheck:10,splashBounce:80},tickCount=0,rain=[],leafs=[],snow=[];function init(e){onResize();for(var t=0;t<clouds.length;t++)clouds[t].offset=Math.random()*sizes.card.width,drawCloud(clouds[t],t);gsap.set(sunburst.node,{opacity:0}),changeWeather(weather[e])}function onResize(){sizes.container.width=container.width(),sizes.container.height=container.height(),sizes.card.width=card.width(),sizes.card.height=card.height(),innerSVG.attr({width:sizes.card.width,height:sizes.card.height}),outerSVG.attr({width:sizes.container.width,height:sizes.container.height}),backSVG.attr({width:sizes.container.width,height:sizes.container.height}),gsap.set(sunburst.node,{transformOrigin:"50% 50%",x:sizes.container.width/2,y:sizes.container.height/2}),gsap.fromTo(sunburst.node,20,{rotation:0},{rotation:360,repeat:-1,ease:"power0.inOut"}),leafMask.attr({x:0,y:0,width:sizes.container.width,height:sizes.container.height})}function drawCloud(e,t){var n=settings.cloudSpace*t+settings.cloudHeight,a=n+settings.cloudArch+Math.random()*settings.cloudArch,i=sizes.card.width,o=[];o.push("M"+[-i,0].join(",")),o.push([i,0].join(",")),o.push("Q"+[2*i,n/2].join(",")),o.push([i,n].join(",")),o.push("Q"+[.5*i,a].join(",")),o.push([0,n].join(",")),o.push("Q"+[-.5*i,a].join(",")),o.push([-i,n].join(",")),o.push("Q"+[-2*i,n/2].join(",")),o.push([-i,0].join(","));var r=o.join(" ");e.path||(e.path=e.group.path()),e.path.animate({d:r},0)}function makeRain(){var e=3*Math.random(),t="thunder"==currentWeather.type?35:14,n=Math.random()*(sizes.card.width-40)+20,a=this["innerRainHolder"+(3-Math.floor(e))].path("M0,0 0,"+t).attr({fill:"none",stroke:"thunder"==currentWeather.type?"#777":"#0000ff",strokeWidth:e});rain.push(a),gsap.fromTo(a.node,{x:n,y:0-t},{duration:1,delay:Math.random(),y:sizes.card.height,ease:"power2.in",onComplete:onRainEnd,onCompleteParams:[a,e,n,currentWeather.type]})}function onRainEnd(e,t,n,a){for(var i in e.remove(),e=null,rain)rain[i].paper||rain.splice(i,1);rain.length<settings.rainCount&&(makeRain(),t>2&&makeSplash(n,a))}function makeSplash(e,t){var n="thunder"==t?30:20,a="thunder"==t?120:100,i="thunder"==t?.7:.5,o=0-Math.random()*a,r=80*Math.random()-40,s=[];s.push("M0,0"),s.push("Q"+r+","+o),s.push(2*r+",80");var d=outerSplashHolder.path(s.join(" ")).attr({fill:"none",stroke:"thunder"==t?"#777":"#0000ff",strokeWidth:1}),c=Snap.path.getTotalLength(d),l=(sizes.container.width-sizes.card.width)/2,u=(sizes.container.height-sizes.card.height)/2+sizes.card.height;d.node.style.strokeDasharray=n+" "+c,gsap.fromTo(d.node,{strokeWidth:2,y:u,x:l+20+e,opacity:1,strokeDashoffset:n},{duration:i,strokeWidth:0,strokeDashoffset:-c,opacity:1,onComplete:onSplashComplete,onCompleteParams:[d],ease:"slow(0.4, 0.1, false)"})}function onSplashComplete(e){e.remove(),e=null}function makeLeaf(){var e,t,n,a,i,o=.5+.5*Math.random(),r=sizes.card.height/2,s=r+Math.random()*r,d=s-(Math.random()*(2*r)-r),c=["#76993E","#4A5E23","#6D632F"],l=c[Math.floor(Math.random()*c.length)];if(o>.8){t=leaf.clone().appendTo(outerLeafHolder).attr({fill:l}),n=(sizes.container.width-sizes.card.width)/2,s+=10,d+=10,i=(sizes.container.width+n)/2,a=sizes.container.width+50,leafs.push(t);var u=[{x:n,y:s},{x:i,y:Math.random()*d+d/3},{x:a,y:d}];gsap.fromTo(t.node,{rotation:180*Math.random(),x:n,y:r+Math.random()*r+10,scale:o},{duration:2,rotation:360*Math.random(),motionPath:u,onComplete:onLeafEnd,onCompleteParams:[t],ease:"power0.in"})}else{e=leaf.clone().appendTo(innerLeafHolder).attr({fill:l}),n=-100,i=sizes.card.width/2,a=sizes.card.width+50,leafs.push(e);u=[{x:n,y:s},{x:i,y:Math.random()*d+d/3},{x:a,y:d}];gsap.fromTo(e.node,{rotation:180*Math.random(),x:n,y:r+Math.random()*r,scale:o},{duration:2,rotation:360*Math.random(),motionPath:u,onComplete:onLeafEnd,onCompleteParams:[e],ease:"power0.in"})}}function onLeafEnd(e){for(var t in e.remove(),e=null,leafs)leafs[t].paper||leafs.splice(t,1);leafs.length<settings.leafCount&&makeLeaf()}function makeSnow(){var e,t,n=.5+.5*Math.random(),a=20+Math.random()*(sizes.card.width-40),i=-10;n>.8?(e=outerSnowHolder.circle(0,0,5).attr({fill:"white"}),t=sizes.container.height+10,i=(sizes.container.height-sizes.card.height)/2+settings.cloudHeight,a+=(sizes.container.width-sizes.card.width)/2):(e=innerSnowHolder.circle(0,0,5).attr({fill:"white"}),t=sizes.card.height+10),snow.push(e),gsap.fromTo(e.node,{x:a,y:i},{duration:3+5*Math.random(),y:t,onComplete:onSnowEnd,onCompleteParams:[e],ease:"power0.in"}),gsap.fromTo(e.node,{scale:0},{duration:1,scale:n,ease:"power1.inOut"}),gsap.to(e.node,{duration:2,x:a+(150*Math.random()-75),repeat:-1,yoyo:!0,ease:"power1.inOut"})}function onSnowEnd(e){for(var t in e.remove(),e=null,snow)snow[t].paper||snow.splice(t,1);snow.length<settings.snowCount&&makeSnow()}function tick(){++tickCount%settings.renewCheck&&(rain.length<settings.rainCount&&makeRain(),leafs.length<settings.leafCount&&makeLeaf(),snow.length<settings.snowCount&&makeSnow());for(var e=0;e<clouds.length;e++)"sun"==currentWeather.type||"clearwind"==currentWeather.type?(clouds[e].offset>-1.5*sizes.card.width&&(clouds[e].offset+=settings.windSpeed/(e+1)),clouds[e].offset>2.5*sizes.card.width&&(clouds[e].offset=-1.5*sizes.card.width),clouds[e].group.transform("t"+clouds[e].offset+",0")):(clouds[e].offset+=settings.windSpeed/(e+1),clouds[e].offset>sizes.card.width&&(clouds[e].offset=clouds[e].offset-sizes.card.width+0),clouds[e].group.transform("t"+clouds[e].offset+",0"));requestAnimationFrame(tick)}function reset(){for(var e=0;e<weather.length;e++)container.removeClass(weather[e].type)}function startLightningTimer(){lightningTimeout&&clearTimeout(lightningTimeout),"thunder"==currentWeather.type&&(lightningTimeout=setTimeout(lightning,6e3*Math.random()))}function lightning(){startLightningTimer(),gsap.fromTo(card,{y:-30},{duration:.75,y:0,ease:"elastic"});for(var e=30+Math.random()*(sizes.card.width-60),t=[e+",0"],n=0;n<20;n++){var a=e+(20*Math.random()-10),i=sizes.card.height/20*(n+1);t.push(a+","+i)}var o=weatherContainer1.path("M"+t.join(" ")).attr({fill:"none",stroke:"white",strokeWidth:2+Math.random()});gsap.to(o.node,{duration:1,opacity:0,ease:"power4.out",onComplete:function(){o.remove(),o=null}})}function changeWeather(e){switch(e.data&&(e=e.data),reset(),currentWeather=e,container.addClass(e.type),e.type){case"cloud":gsap.to(settings,{duration:3,windSpeed:1.5,ease:"power2.inOut"});break;case"wind":gsap.to(settings,{duration:3,windSpeed:8,ease:"power2.inOut"});break;case"sun":case"clearwind":gsap.to(settings,{duration:3,windSpeed:20,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:3,windSpeed:.5,ease:"power2.out"});break}switch(e.type){case"rain":gsap.to(settings,{duration:3,rainCount:20,ease:"power2.inOut"});break;case"drizzle":gsap.to(settings,{duration:3,rainCount:5,ease:"power2.inOut"});break;case"thunder":gsap.to(settings,{duration:3,rainCount:60,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,rainCount:0,ease:"power2.out"});break}switch(e.type){case"wind":case"clearwind":gsap.to(settings,{duration:3,leafCount:5,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,leafCount:0,ease:"power2.out"});break}switch(e.type){case"snow":gsap.to(settings,{duration:3,snowCount:40,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,snowCount:0,ease:"power2.out"});break}switch(e.type){case"sun":case"clearwind":gsap.to(sun.node,{duration:4,x:sizes.card.width/2,y:sizes.card.height/2,ease:"power2.inOut"}),window.innerWidth<=717?gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2-80,ease:"power2.inOut"}):gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2,ease:"power2.inOut"});break;default:gsap.to(sun.node,{duration:2,x:sizes.card.width/2,y:-100,ease:"power2.inOut"}),gsap.to(sunburst.node,{duration:2,scale:.4,opacity:0,y:sizes.container.height/2-50,ease:"power2.inOut"});break}startLightningTimer()}function ipLookUp(){var e=new XMLHttpRequest;e.open("get","https://freegeoip.app/json/"),e.onreadystatechange=function(){if(4===e.readyState){var t=JSON.parse(e.responseText);getWeather(t.longitude,t.latitude)}},e.send()}function getWeather(e,t){var n=new XMLHttpRequest;n.open("get","https://api.openweathermap.org/data/2.5/weather?lon="+e+"&lat="+t+"&appid=81687cda5c5bdb04678a2547f9a43d6d&units=metric"),n.onreadystatechange=function(){4===n.readyState&&handleJson(JSON.parse(n.responseText))},n.send()}function handleJson(e){var t=e.weather[0].main,n=e.weather[0].id;let a;document.getElementById("summary").innerHTML=t,document.getElementById("city").innerHTML=e.name+" &#xe901",document.getElementById("detail").innerHTML=e.weather[0].description,document.getElementById("temp").innerHTML=Math.round(10*e.main.temp)/10+"<span>℃</span>",document.getElementById("temprange").innerHTML="<p>"+Math.round(10*e.main.temp_min)/10+"℃ to "+Math.round(10*e.main.temp_max)/10+"℃</p><p> &#xe90b "+e.main.humidity+"%</p>",a="Snow"==t?0:"Rain"==t?2:"Thunderstorm"==t?3:"Clear"==t&&e.wind.speed<6.7?4:"Clear"==t?8:"Clouds"==t&&e.wind.speed<6.7?5:n>700&&n<800?6:"Drizzle"==t?7:1,init(a),window.addEventListener("resize",widgetResize),requestAnimationFrame(tick),document.getElementById("time").innerHTML=(new Date).getHours()+":"+checkTime((new Date).getMinutes()),getSysSun(e.sys.sunrise,e.sys.sunset,e.timezone),jinrishici.load((function(e){document.getElementById("hitokoto").innerHTML=e.data.content+"<p>──【"+e.data.origin.dynasty+"】"+e.data.origin.author+"《"+e.data.origin.title+"》</p>"}))}function widgetResize(){onResize();for(var e=0;e<clouds.length;e++)clouds[e].offset=Math.random()*sizes.card.width,drawCloud(clouds[e],e);changeWeather(currentWeather)}function checkTime(e){return e<10&&(e="0"+e),e}function loadStyleString(e){var t=document.createElement("style");t.type="text/css";try{t.appendChild(document.createTextNode(e))}catch(n){t.styleSheet.cssText=e}document.getElementsByTagName("head")[0].appendChild(t)}function setBackground(e,t){risemin=60*e.getUTCHours()+e.getUTCMinutes(),setmin=60*t.getUTCHours()+t.getUTCMinutes(),noonmin=(risemin+setmin)/2,realmin=60*(new Date).getHours()+(new Date).getMinutes(),realmin<=risemin-60?(i="n5.webp",color="#755be3"):realmin>risemin-60&&realmin<=risemin-30?(i="n6.webp",color="#2a6a9e"):realmin>risemin-30&&realmin<=risemin?(i="d0.webp",color="#ed95d1"):realmin>risemin&&realmin<=risemin+30?(i="d1.webp",color="#de9cd7"):realmin>risemin+30&&realmin<=risemin+90?(i="d2.webp",color="#3c82cc"):realmin>risemin+90&&realmin<=risemin+150?(i="d3.webp",color="#95bdcc"):realmin>risemin+150&&realmin<=risemin+210?(i="d4.webp",color="#68c9f1"):realmin>risemin+210&&realmin<=noonmin+60?(i="d5.webp",color="#2fa0e6"):realmin>noonmin+60&&realmin<=noonmin+120?(i="d6.webp",color="#6b8b4c"):realmin>noonmin+120&&realmin<=setmin-60?(i="d7.webp",color="#af5c18"):realmin>setmin-60&&realmin<=setmin?(i="d8.webp",color="#da644f"):realmin>setmin&&realmin<=setmin+30?(i="n0.webp",color="#b6bbf5"):realmin>setmin+30&&realmin<=setmin+60?(i="n1.webp",color="#897ddc"):realmin>setmin+60&&realmin<=setmin+120?(i="n2.webp",color="#3e7ee3"):realmin>setmin+60&&realmin<=1320?(i="n3.webp",color="#36315a"):realmin>1320&&(i="n4.webp",color="#3d3d88"),css="#fill_screen{background:url('./background/"+i+"') no-repeat local center center/cover;}",metaThemeColor=document.querySelector("meta[name=theme-color]"),metaThemeColor.setAttribute("content",color),loadStyleString(css)}function getSysSun(e,t,n){sunrise=new Date(1e3*(e+n)),sunset=new Date(1e3*(t+n)),document.getElementById("temprange").insertAdjacentHTML("beforeend","<p>&#xe9d6 "+sunrise.getUTCHours()+":"+checkTime(sunrise.getUTCMinutes())+" to "+sunset.getUTCHours()+":"+checkTime(sunset.getUTCMinutes())+"</p>"),setBackground(sunrise,sunset)}ipLookUp(),function(e){var t,n={},a="jinrishici-token";function i(e,t){var n=new XMLHttpRequest;n.open("get",t),n.withCredentials=!0,n.send(),n.onreadystatechange=function(t){if(4===n.readyState){var a=JSON.parse(n.responseText);"success"===a.status&&e(a)}}}n.load=function(t){return e.localStorage&&e.localStorage.getItem(a)?function(e,t){return i(e,"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2&X-User-Token="+encodeURIComponent(t))}(t,e.localStorage.getItem(a)):function(t){return i((function(n){e.localStorage.setItem(a,n.token),t(n)}),"https://v2.jinrishici.com/one.json?client=browser-sdk/1.2")}(t)},e.jinrishici=n,t=function(){},"loading"!=document.readyState||(document.addEventListener?document.addEventListener("DOMContentLoaded",t):document.attachEvent("onreadystatechange",(function(){document.readyState})))}(window);