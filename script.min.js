function clickEffect(e){const i=document.createElement("div");i.className="clickEffect",i.style.top=e.clientY+"px",i.style.left=e.clientX+"px",document.body.appendChild(i),i.addEventListener("animationend",(function(){i.parentElement.removeChild(i)}))}"serviceWorker"in navigator&&navigator.serviceWorker.register("service-worker.js"),document.addEventListener("click",clickEffect);const bid=document.getElementById("search_baidu");function baidu(keys){const len=keys.s.length,boxid=document.getElementById("keywordb"),hid=document.getElementById("googlebar");0===len?(boxid.style.display="none",hid.style.display="block"):(boxid.style.transform="scaleY(1)",boxid.style.display="block",hid.style.display="none");let spans="";for(let i=0;i<len;i++)spans+="<span>"+keys.s[i]+"</span>";boxid.innerHTML=spans;for(let i=0;i<boxid.children.length;i++){const ele=boxid.children[i];ele.onclick=function(){bid.value=this.innerHTML,bid.focus(),tobaidu()}}document.body.addEventListener("click",(function(evt){const target=evt.target;"keywordb"!==target.id&&"baidubar"!==target.id&&"search_baidu"!==target.id&&(boxid.style.transform="scaleY(0)",hid.style.display="block",boxid.style.display="none")}),!1)}bid.addEventListener("keyup",(function(){if(!bid.value)return;const s=document.createElement("script");s.type="text/javascript",s.src="https://suggestion.baidu.com/su?wd="+bid.value+"&cb=baidu";const h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(s,h)}),!1);const gid=document.getElementById("search_google");function google(keys){const len=keys[1].length,boxid=document.getElementById("keywordg"),hid=document.getElementById("baidubar");0===len?(boxid.style.display="none",hid.style.display="block"):(boxid.style.transform="scaleY(1)",boxid.style.display="block",hid.style.display="none");let spans="";for(let i=0;i<len;i++)spans+="<span>"+keys[1][i]+"</span>";boxid.innerHTML=spans;for(let i=0;i<boxid.children.length;i++){const ele=boxid.children[i];ele.onclick=function(){gid.value=this.innerHTML,gid.focus(),togoogle()}}document.body.addEventListener("click",(function(evt){const target=evt.target;"keywordb"!==target.id&&"googlebar"!==target.id&&"search_google"!==target.id&&(boxid.style.transform="scaleY(0)",hid.style.display="block",boxid.style.display="none")}),!1)}function tobaidu(){return""!==bid.value&&(window.location.href="https://www.baidu.com/s?wd="+bid.value,bid.value=""),!1}function togoogle(){return""!==gid.value&&(window.location.href="https://www.google.com/search?q="+gid.value,gid.value=""),!1}gid.addEventListener("keyup",(function(){if(!gid.value)return;const s=document.createElement("script");s.type="text/javascript",s.src="https://suggestqueries.google.com/complete/search?q="+gid.value+"&output=firefox&callback=google";const h=document.getElementsByTagName("script")[0];h.parentNode.insertBefore(s,h)}),!1),gsap.registerPlugin(MotionPathPlugin);const container=document.getElementById("weathercontainer"),card=document.getElementById("card");window.innerWidth<=717&&card.classList.remove("nmbar");const innerSVG=Snap("#inner"),outerSVG=Snap("#outer"),backSVG=Snap("#back"),weatherContainer1=Snap.select("#layer1"),weatherContainer2=Snap.select("#layer2"),weatherContainer3=Snap.select("#layer3"),innerRainHolder1=weatherContainer1.group(),innerRainHolder2=weatherContainer2.group(),innerRainHolder3=weatherContainer3.group(),innerLeafHolder=weatherContainer1.group(),innerSnowHolder=weatherContainer1.group(),innerLightningHolder=weatherContainer1.group(),leafMask=outerSVG.rect(),leaf=Snap.select("#leaf"),sun=Snap.select("#sun"),sunburst=Snap.select("#sunburst"),outerSplashHolder=outerSVG.group(),outerLeafHolder=outerSVG.group(),outerSnowHolder=outerSVG.group();let currentWeather,lightningTimeout;outerLeafHolder.attr({"clip-path":leafMask});const sizes={container:{width:0,height:0},card:{width:0,height:0}},clouds=[{group:Snap.select("#cloud1")},{group:Snap.select("#cloud2")},{group:Snap.select("#cloud3")}],weather=[{type:"snow"},{type:"wind"},{type:"rain"},{type:"thunder"},{type:"sun"},{type:"cloud"},{type:"haze"},{type:"drizzle"},{type:"clearwind"}],settings={windSpeed:2,rainCount:0,leafCount:0,snowCount:0,cloudHeight:100,cloudSpace:30,cloudArch:50,renewCheck:10,splashBounce:80};let tickCount=0;const rain=[],leafs=[],snow=[];function init(index){onResize();for(let i=0;i<clouds.length;i++)clouds[i].offset=Math.random()*sizes.card.width,drawCloud(clouds[i],i);gsap.set(sunburst.node,{opacity:0}),changeWeather(weather[index])}function onResize(){sizes.container.width=container.offsetWidth,sizes.container.height=container.offsetHeight,sizes.card.width=card.offsetWidth,sizes.card.height=card.offsetHeight,innerSVG.attr({width:sizes.card.width,height:sizes.card.height}),outerSVG.attr({width:sizes.container.width,height:sizes.container.height}),backSVG.attr({width:sizes.container.width,height:sizes.container.height}),gsap.set(sunburst.node,{transformOrigin:"50% 50%",x:sizes.container.width/2,y:sizes.container.height/2}),gsap.fromTo(sunburst.node,20,{rotation:0},{rotation:360,repeat:-1,ease:"power0.inOut"}),leafMask.attr({x:0,y:0,width:sizes.container.width,height:sizes.container.height})}function drawCloud(cloud,i){const space=settings.cloudSpace*i,height=space+settings.cloudHeight,arch=height+settings.cloudArch+Math.random()*settings.cloudArch,width=sizes.card.width,points=[];points.push("M"+[-width,0].join(",")),points.push([width,0].join(",")),points.push("Q"+[2*width,height/2].join(",")),points.push([width,height].join(",")),points.push("Q"+[.5*width,arch].join(",")),points.push([0,height].join(",")),points.push("Q"+[-.5*width,arch].join(",")),points.push([-width,height].join(",")),points.push("Q"+[-2*width,height/2].join(",")),points.push([-width,0].join(","));const path=points.join(" ");cloud.path||(cloud.path=cloud.group.path()),cloud.path.animate({d:path},0)}function makeRain(){const lineWidth=3*Math.random(),lineLength="thunder"===currentWeather.type?35:14,x=Math.random()*(sizes.card.width-40)+20,line=this["innerRainHolder"+(3-Math.floor(lineWidth))].path("M0,0 0,"+lineLength).attr({fill:"none",stroke:"thunder"===currentWeather.type?"#777":"#0000ff",strokeWidth:lineWidth});rain.push(line),gsap.fromTo(line.node,{x:x,y:0-lineLength},{duration:1,delay:Math.random(),y:sizes.card.height,ease:"power2.in",onComplete:onRainEnd,onCompleteParams:[line,lineWidth,x,currentWeather.type]})}function onRainEnd(line,width,x,type){line.remove(),line=null;for(const i in rain)rain[i].paper||rain.splice(i,1);rain.length<settings.rainCount&&(makeRain(),width>2&&makeSplash(x,type))}function makeSplash(x,type){const splashLength="thunder"===type?30:20,splashBounce="thunder"===type?120:100,splashDistance=80,speed="thunder"===type?.7:.5,splashUp=0-Math.random()*splashBounce,randomX=80*Math.random()-40,points=[];points.push("M0,0"),points.push("Q"+randomX+","+splashUp),points.push(2*randomX+",80");const splash=outerSplashHolder.path(points.join(" ")).attr({fill:"none",stroke:"thunder"===type?"#777":"#0000ff",strokeWidth:1}),pathLength=Snap.path.getTotalLength(splash),xOffset=(sizes.container.width-sizes.card.width)/2,yOffset=(sizes.container.height-sizes.card.height)/2+sizes.card.height;splash.node.style.strokeDasharray=splashLength+" "+pathLength,gsap.fromTo(splash.node,{strokeWidth:2,y:yOffset,x:xOffset+20+x,opacity:1,strokeDashoffset:splashLength},{duration:speed,strokeWidth:0,strokeDashoffset:-pathLength,opacity:1,onComplete:onSplashComplete,onCompleteParams:[splash],ease:"slow(0.4, 0.1, false)"})}function onSplashComplete(splash){splash.remove(),splash=null}function makeLeaf(){const scale=.5+.5*Math.random();let newLeaf,outerLeaf;const areaY=sizes.card.height/2;let y=areaY+Math.random()*areaY,endY=y-(Math.random()*(2*areaY)-areaY),x;const colors=["#76993E","#4A5E23","#6D632F"],color=colors[Math.floor(Math.random()*colors.length)];let xBezier;if(scale>.8){outerLeaf=leaf.clone().appendTo(outerLeafHolder).attr({fill:color}),x=(sizes.container.width-sizes.card.width)/2,y+=10,endY+=10,xBezier=(sizes.container.width+x)/2,leafs.push(outerLeaf);const motionPath=[{x:x,y:y},{x:xBezier,y:Math.random()*endY+endY/3},{x:sizes.container.width+50,y:endY}];gsap.fromTo(outerLeaf.node,{rotation:180*Math.random(),x:x,y:areaY+Math.random()*areaY+10,scale:scale},{duration:2,rotation:360*Math.random(),motionPath:motionPath,onComplete:onLeafEnd,onCompleteParams:[outerLeaf],ease:"power0.in"})}else{newLeaf=leaf.clone().appendTo(innerLeafHolder).attr({fill:color}),x=-100,xBezier=sizes.card.width/2,leafs.push(newLeaf);const motionPath=[{x:x,y:y},{x:xBezier,y:Math.random()*endY+endY/3},{x:sizes.card.width+50,y:endY}];gsap.fromTo(newLeaf.node,{rotation:180*Math.random(),x:x,y:areaY+Math.random()*areaY,scale:scale},{duration:2,rotation:360*Math.random(),motionPath:motionPath,onComplete:onLeafEnd,onCompleteParams:[newLeaf],ease:"power0.in"})}}function onLeafEnd(leaf){leaf.remove(),leaf=null;for(const i in leafs)leafs[i].paper||leafs.splice(i,1);leafs.length<settings.leafCount&&makeLeaf()}function makeSnow(){const scale=.5+.5*Math.random();let newSnow,x=20+Math.random()*(sizes.card.width-40),y=-10,endY;scale>.8?(newSnow=outerSnowHolder.circle(0,0,5).attr({fill:"white"}),endY=sizes.container.height+10,y=(sizes.container.height-sizes.card.height)/2+settings.cloudHeight,x+=(sizes.container.width-sizes.card.width)/2):(newSnow=innerSnowHolder.circle(0,0,5).attr({fill:"white"}),endY=sizes.card.height+10),snow.push(newSnow),gsap.fromTo(newSnow.node,{x:x,y:y},{duration:3+5*Math.random(),y:endY,onComplete:onSnowEnd,onCompleteParams:[newSnow],ease:"power0.in"}),gsap.fromTo(newSnow.node,{scale:0},{duration:1,scale:scale,ease:"power1.inOut"}),gsap.to(newSnow.node,{duration:2,x:x+(150*Math.random()-75),repeat:-1,yoyo:!0,ease:"power1.inOut"})}function onSnowEnd(flake){flake.remove(),flake=null;for(const i in snow)snow[i].paper||snow.splice(i,1);snow.length<settings.snowCount&&makeSnow()}function tick(){tickCount++;const check=tickCount%settings.renewCheck;check&&(rain.length<settings.rainCount&&makeRain(),leafs.length<settings.leafCount&&makeLeaf(),snow.length<settings.snowCount&&makeSnow());for(let i=0;i<clouds.length;i++)"sun"===currentWeather.type||"clearwind"===currentWeather.type?(clouds[i].offset>-1.5*sizes.card.width&&(clouds[i].offset+=settings.windSpeed/(i+1)),clouds[i].offset>2.5*sizes.card.width&&(clouds[i].offset=-1.5*sizes.card.width),clouds[i].group.transform("t"+clouds[i].offset+",0")):(clouds[i].offset+=settings.windSpeed/(i+1),clouds[i].offset>sizes.card.width&&(clouds[i].offset=clouds[i].offset-sizes.card.width+0),clouds[i].group.transform("t"+clouds[i].offset+",0"));requestAnimationFrame(tick)}function reset(){for(let i=0;i<weather.length;i++)container.classList.remove(weather[i].type)}function startLightningTimer(){lightningTimeout&&clearTimeout(lightningTimeout),"thunder"===currentWeather.type&&(lightningTimeout=setTimeout(lightning,6e3*Math.random()))}function lightning(){startLightningTimer(),gsap.fromTo(card,{y:-30},{duration:.75,y:0,ease:"elastic"});const pathX=30+Math.random()*(sizes.card.width-60),yOffset=20,steps=20,points=[pathX+",0"];for(let i=0;i<20;i++){const x=pathX+(20*Math.random()-10),y=sizes.card.height/20*(i+1);points.push(x+","+y)}let strike=weatherContainer1.path("M"+points.join(" ")).attr({fill:"none",stroke:"white",strokeWidth:2+Math.random()});gsap.to(strike.node,{duration:1,opacity:0,ease:"power4.out",onComplete:function(){strike.remove(),strike=null}})}function changeWeather(weather){switch(weather.data&&(weather=weather.data),reset(),currentWeather=weather,container.classList.add(weather.type),weather.type){case"cloud":gsap.to(settings,{duration:3,windSpeed:1.5,ease:"power2.inOut"});break;case"wind":gsap.to(settings,{duration:3,windSpeed:8,ease:"power2.inOut"});break;case"sun":case"clearwind":gsap.to(settings,{duration:3,windSpeed:20,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:3,windSpeed:.5,ease:"power2.out"})}switch(weather.type){case"rain":gsap.to(settings,{duration:3,rainCount:20,ease:"power2.inOut"});break;case"drizzle":gsap.to(settings,{duration:3,rainCount:5,ease:"power2.inOut"});break;case"thunder":gsap.to(settings,{duration:3,rainCount:60,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,rainCount:0,ease:"power2.out"})}switch(weather.type){case"wind":case"clearwind":gsap.to(settings,{duration:3,leafCount:5,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,leafCount:0,ease:"power2.out"})}switch(weather.type){case"snow":gsap.to(settings,{duration:3,snowCount:40,ease:"power2.inOut"});break;default:gsap.to(settings,{duration:1,snowCount:0,ease:"power2.out"})}switch(weather.type){case"sun":case"clearwind":gsap.to(sun.node,{duration:4,x:sizes.card.width/2,y:sizes.card.height/2,ease:"power2.inOut"}),window.innerWidth<=717?gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2-80,ease:"power2.inOut"}):gsap.to(sunburst.node,{duration:4,scale:1,opacity:.8,y:sizes.container.height/2,ease:"power2.inOut"});break;default:gsap.to(sun.node,{duration:2,x:sizes.card.width/2,y:-100,ease:"power2.inOut"}),gsap.to(sunburst.node,{duration:2,scale:.4,opacity:0,y:sizes.container.height/2-50,ease:"power2.inOut"})}startLightningTimer()}getWeather();const xhr=new XMLHttpRequest;function getWeather(){const xhr=new XMLHttpRequest;xhr.open("get","https://api.weatherapi.com/v1/forecast.json?key=483957d90eb54b5d88552513210506&q=auto:ip&days=1"),xhr.onreadystatechange=function(){if(4===xhr.readyState){const response=JSON.parse(xhr.responseText);handleJson(response.location.name,response.current.temp_c,response.current.condition.text,response.current.condition.code,response.current.wind_kph,response.current.humidity,response.forecast.forecastday[0])}},xhr.send()}function handleJson(city,temp,weather,code,wind,humidity,arr){document.getElementById("city").innerHTML=city+" &#xe901",document.getElementById("detail").innerHTML=weather,document.getElementById("temp").innerHTML=temp+"<span>℃</span>";const rise=arr.astro.sunrise.split(":"),rmin=parseFloat(rise[1].split(" ")[0]),set=arr.astro.sunset.split(":");let shr=parseFloat(set[0]);3===set[1].indexOf("PM")&&(shr+=12);const smin=parseFloat(set[1].split(" ")[0]);let i,t;document.getElementById("temprange").innerHTML="<p>"+arr.day.mintemp_c+"℃ to "+arr.day.maxtemp_c+"℃</p><p> &#xe90b "+humidity+"%</p><p>&#xe9d6 "+rise[0]+":"+rmin+" to "+shr+":"+smin+"</p>",1066===code||1069===code||1114===code||1204===code||1207===code||1210===code||1213===code||1216===code||1219===code||1222===code||1225===code||1237===code||1249===code||1252===code||1255===code||1258===code||1261===code||1264===code||1279===code||1282===code?(i=0,t="Snow"):code>1272&&code<1283?(i=3,t="Drizzle"):1e3===code&&wind<29?(i=4,t="Clear"):1e3===code?(i=8,t="Wind"):code>1002&&code<1010&&wind<29?(i=5,t="Cloud"):code>1002&&code<1010?(i=1,t="Wind"):1030===code||1135===code||1147===code?(i=6,t="Fog"):1072===code||code>1149&&code<1172?i=7:(i=2,t="Rain"),document.getElementById("summary").innerHTML=t,document.getElementById("time").innerHTML=(new Date).getHours()+":"+checkTime((new Date).getMinutes());const risemin=60*parseFloat(rise[0])+rmin,setmin=60*shr+smin;setBackground(risemin,setmin),init(i),window.addEventListener("resize",widgetResize),requestAnimationFrame(tick)}function printH(content,author,origin){document.getElementById("hitokoto").innerHTML=null==author?content+"<p>──《"+origin+"》</p>":content+"<p>──"+author+"《"+origin+"》</p>"}function widgetResize(){onResize();for(let i=0;i<clouds.length;i++)clouds[i].offset=Math.random()*sizes.card.width,drawCloud(clouds[i],i);changeWeather(currentWeather)}function checkTime(m){return m<10&&(m="0"+m),m}function loadStyleString(cssText){const style=document.createElement("style");try{style.appendChild(document.createTextNode(cssText))}catch(ex){style.styleSheet.cssText=cssText}document.getElementsByTagName("head")[0].appendChild(style)}function setBackground(risemin,setmin){const int=(setmin-risemin)/8,realmin=60*(new Date).getHours()+(new Date).getMinutes();let i,color;realmin<=risemin-1.5*int?(i="n5.webp",color="#755be3"):realmin>risemin-1.5*int&&realmin<=risemin-int/2?(i="n6.webp",color="#2a6a9e"):realmin>risemin-int/2&&realmin<=risemin?(i="d0.webp",color="#ed95d1"):realmin>risemin&&realmin<=risemin+int/2?(i="d1.webp",color="#de9cd7"):realmin>risemin+int/2&&realmin<=risemin+1.5*int?(i="d2.webp",color="#3c82cc"):realmin>risemin+1.5*int&&realmin<=risemin+3*int?(i="d3.webp",color="#95bdcc"):realmin>risemin+3*int&&realmin<=risemin+4*int?(i="d4.webp",color="#68c9f1"):realmin>risemin+4*int&&realmin<=risemin+5*int?(i="d5.webp",color="#2fa0e6"):realmin>risemin+5*int&&realmin<=risemin+6*int?(i="d6.webp",color="#6b8b4c"):realmin>risemin+6*int&&realmin<=risemin+7.5*int?(i="d7.webp",color="#af5c18"):realmin>risemin+7.5*int&&realmin<=setmin?(i="d8.webp",color="#da644f"):realmin>setmin&&realmin<=setmin+int/2?(i="n0.webp",color="#b6bbf5"):realmin>setmin+int/2&&realmin<=setmin+1.5*int?(i="n1.webp",color="#897ddc"):realmin>setmin+1.5*int&&realmin<=setmin+3*int?(i="n2.webp",color="#3e7ee3"):realmin>setmin+3*int&&realmin<=1320?(i="n3.webp",color="#36315a"):realmin>1320&&(i="n4.webp",color="#3d3d88"),document.querySelector("meta[name=theme-color]").setAttribute("content",color),loadStyleString("#fill_screen{background:url('/background/"+i+"') no-repeat local center center/cover;}")}xhr.open("get","https://v1.hitokoto.cn/?c=i"),xhr.onreadystatechange=function(){if(4===xhr.readyState){const response=JSON.parse(xhr.responseText);printH(response.hitokoto,response.from_who,response.from)}},xhr.send();const duration=.4;let isDay=!0;const scale=30,toNightAnimation=gsap.timeline();window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?document.getElementById("sunburst").style.display="none":toNightAnimation.pause(),toNightAnimation.to("#circle",{duration:.4,ease:"power4.in",scaleX:30,scaleY:30,x:1,transformOrigin:"100% 50%"},0).set("#circle",{scaleX:-30},.4).to("#circle",{duration:.4,ease:"power4.out",scaleX:-1,scaleY:1,x:2},.4).fromTo(".filter",{filter:"brightness(100%)"},{filter:"brightness(50%)",duration:.4},0).to(".nmtext,.nmbar",{color:"white",duration:.8},0).to(".nmbar",{background:"rgba(0,0,0,.3)",duration:.4},0).fromTo(".nmbar",{boxShadow:"0 0 18px rgba(70, 70, 40, .255)"},{boxShadow:"0 0 18px rgba(0, 0, 0, .255)",duration:.4},0).to("#cloud1",{fill:"#101010",duration:.4},0).to("#cloud2",{fill:"#191919",duration:.4},0).to("#cloud3",{fill:"#2a2a2a",duration:.4},0).to("#sun",{fill:"#3e3f57",duration:.8},0).to("#sunburst",{opacity:"0",duration:.8},0);const stars=Array.from(document.getElementsByClassName("star"));stars.map(star=>gsap.to(star,{duration:"random(0.4, 1.5)",repeat:-1,yoyo:!0,opacity:"random(0.2, 0.5)"})),gsap.to(".clouds-big",{duration:15,repeat:-1,x:-74,ease:"linear"}),gsap.to(".clouds-medium",{duration:20,repeat:-1,x:-65,ease:"linear"}),gsap.to(".clouds-small",{duration:25,repeat:-1,x:-71,ease:"linear"});const switchToggle=document.getElementById("input");switchToggle.addEventListener("change",()=>toggle());const toggle=()=>{isDay=!0===switchToggle.checked,isDay?(document.getElementById("sunburst").style.display="block",toNightAnimation.reverse()):toNightAnimation.play()};